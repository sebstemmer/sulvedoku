# Create and Solve Sudokus (with Convolutional Neural Networks)

This repository focuses on solving Sudokus, generating filled Sudoku grids, and creating Sudokus with a specified number
of clues. A detailed explanation and additional context can be found
in [a post on my personal blog](https://sebstemmer.com/algorithms/2025/09/23/create-and-solve-sudokus.html).

In addition, a convolutional neural network is trained and integrated into the classical Sudoku backtracking algorithm.
A detailed explanation and evaluation of this approach are provided
in [another post on my personal blog](https://sebstemmer.com/algorithms/2025/10/09/solve-sudokus-with-convolutional-neural-networks.html).

**Note:** All scripts should be executed using

```
python -m ...
```

from the **root** of the repository.

## Structure

```
├── data/
├── grid/
├── solve/
├── create/
├── common/
├── benchmark/
├── neural_solve/
```

* `data/` contains the test and benchmarking datasets, the training data for the neural network, and the saved model
  checkpoints.
* `grid/` provides utility functions for working with Sudoku grids.
* `solve/` includes everything related to solving Sudokus with backtracking approaches.
* `create/` handles generating Sudokus with a specified number of clues.
* `common/` contains shared utility functions.
* `benchmark/` includes scripts for benchmarking the performance of the different algorithms.
* `neural_solve/` contains scripts for creating training data, training a neural network and using it in a guess
  strategy.

## Installation

After cloning the repository, create a virtual environment:

```
python -m venv venv
```

Activate the environment:

```
source ./venv/bin/activate
```

Install the required dependencies:

```
pip install -r requirements.txt
```

### Create a Grid from a Sudoku String

You can obtain a `Grid` from a Sudoku string with:

```
grid/grid.py - str_to_grid(
        grid_as_str: str
) -> Grid
```

Unit tests for grid functionality can be run with:

```
python -m grid.grid_test_script
```

## Solve Sudokus

Sudoku solving is implemented in:

```
solve/solve.py - solve_grid(
        grid: Grid,
        guess_strategy: Callable[
            [Grid], tuple[Coord, int]
        ] = smallest_allowed_guess_strategy,
        max_depth: Optional[int] = None
) -> Grid
```

with sensible defaults for `guess_strategy` and `max_depth`.

Unit tests for solving functionality can be run with:

```
python -m solve.solve_test_script
```

## Create Filled Sudoku Grids

Use:

```
solve/solve.py - create_filled(
        max_depth: Optional[int] = 100,
        guess_strategy: Callable[[Grid], tuple[Coord, int]] = random_guess_strategy
) -> Grid
```

to create a filled Sudoku grid. The defaults for `max_depth` and `guess_strategy` ensure randomness and strong
performance.

## Create Sudokus

Creating a Sudoku with a specified number of clues `num_filled_target` is implemented in:

```
create/create.py - create_grid(
        num_filled_target: int,
        max_remove_depth: int = 100,
) -> Grid
```

The default for `max_remove_depth` provides good performance.

With the script:

```
python -m create.create_and_print_sudoku_script
```

a Sudoku with the desired number of clues specified at the top is generated and printed to the console.

## Benchmarking

The solvers can be benchmarked with:

```
python -m benchmark.solve_many_sudokus_script
```

using non-trivial Sudoku data generated by:

```
python -m benchmark.create_non_trivial_sudokus_script
```

from [raw data](https://www.kaggle.com/datasets/bryanpark/sudoku) placed in `/data`.

The optimal `max_depth` or creating filled Sudoku grids can be determined with:

```
python -m benchmark.create_filled_script
```

The optimal `max_remove_depth` for creating Sudokus with a specified number of clues can be determined with:

```
python -m benchmark.create_script
```

## Neural Sudoku Solver

The script

```
python -m neural_solve.create_train_data_script
```

transforms the [raw dataset](https://www.kaggle.com/datasets/radcliffe/3-million-sudoku-puzzles-with-ratings) into the
final training data used for model training.

The neural network, defined in

```
neural_solve/model.py
```

can be trained using:

```
python -m neural_solve.train_script
```

It uses the PyTorch dataset defined in

```
neural_solve/dataset.py
```

A unit test for a model function is provided in:

```
python -m neural_solve.model_test_script
```

All hyperparameters and utility functions, such as the cross-entropy loss and validation logic, are defined in:

```
neural_solve/train_utils.py
```

The training script saves losses, model parameters, and checkpoints in the `data/sudoku_net_training_checkpoints`
directory.
The losses can be visualized using:

```
neural_solve/visualize_training_loss_script.py
```

The best-performing model is saved as `data/final_sudoku_net_model.pth` and is used in:

```
neural_solve/solve.py - neural_guess_strategy(
        grid: Grid
) -> tuple[Coord, int]
```

which integrates into the classical backtracking algorithm.

Utility functions for creating the target and allowed-values masks from a Sudoku are implemented in:

```
neural_solve/solve.py - create_x_target_mask_and_allowed_values_mask(
        coord_to_value: dict[Coord, int],
        coord_to_allowed_values: dict[Coord, tuple[int, ...]]
) -> tuple[torch.Tensor, torch.Tensor, torch.Tensor]
```

The function that determines where the neural network is most confident is defined in:

```
neural_solve/get_most_certain_coord_and_index_value.py - get_most_certain_coord_and_index_value(
        allowed_mask_n_81_9: torch.Tensor,
        logits_n_81_9: torch.Tensor,
        target_mask_n_81: torch.Tensor
) -> tuple[list[Coord], list[int]]
```

Model evaluation on the test set can be performed using:

```
neural_solve/evaluate_on_test_set_script.py
```

